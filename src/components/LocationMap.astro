---
import { DEFAULT_LOCATION_MAP_ZOOM } from '../data/locations';

type Props = {
  name: string;
  city: string;
  state: string;
  lat?: number | null;
  lng?: number | null;
  zoom?: number | null;
};

const { name, city, state, lat, lng, zoom } = Astro.props as Props;
const hasCoordinates = Number.isFinite(lat) && Number.isFinite(lng);
const fallbackQueryBase = name?.trim() || city?.trim() || state?.trim() || 'Ohio';
const stateToken = state?.trim() || 'OH';
const fallbackQuery = `${fallbackQueryBase}, ${stateToken}`;
const fallbackZoom = hasCoordinates ? DEFAULT_LOCATION_MAP_ZOOM + 2 : DEFAULT_LOCATION_MAP_ZOOM;
const mapZoom = Number.isFinite(zoom) ? zoom : fallbackZoom;
const mapQuery = hasCoordinates ? `loc:${lat},${lng}` : fallbackQuery;
const mapSrc = mapQuery
  ? `https://www.google.com/maps?q=${encodeURIComponent(mapQuery)}&z=${mapZoom}&output=embed`
  : `https://www.google.com/maps?q=${encodeURIComponent('Ohio')}&z=${mapZoom}&output=embed`;
const mapTitle = `${name} Service Area Map`;
const isDev = import.meta.env.DEV;
---

<section class="py-16 bg-white">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="max-w-3xl mx-auto text-center mb-8">
      <p class="text-sm font-semibold uppercase tracking-[0.3em] text-primary/70 mb-4">Service Area Map</p>
      <h2 class="text-3xl font-bold text-ink mb-3">Find our {name} coverage</h2>
      <p class="text-base text-ink/70 leading-relaxed">
        This map highlights the primary service area for {name} garage door repair, installation, and opener support.
      </p>
      {isDev && (
        <p class="mt-3 text-xs text-ink/60">
          Map debug: {name} {hasCoordinates ? `${lat},${lng}` : 'no coords'} zoom {mapZoom}
        </p>
      )}
    </div>

    <div
      class="mx-auto w-full max-w-[280px] overflow-hidden rounded-2xl border border-ink/10 shadow-sm relative"
      style="aspect-ratio: 1 / 1;"
    >
      <iframe
        title={mapTitle}
        src={mapSrc}
        loading="lazy"
        class="absolute inset-0 h-full w-full"
        referrerpolicy="no-referrer-when-downgrade"
      ></iframe>
    </div>
  </div>
</section>
