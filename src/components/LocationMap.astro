---
import { DEFAULT_LOCATION_MAP_ZOOM } from '../data/locations';

type Props = {
  name: string;
  city: string;
  state: string;
  lat?: number | null;
  lng?: number | null;
  zoom?: number | null;
};

const { name, city, state, lat, lng, zoom } = Astro.props as Props;
const hasCoordinates = Number.isFinite(lat) && Number.isFinite(lng);
const nameToken = name?.trim();
const cityToken = city?.trim();
const fallbackQueryBase = nameToken || cityToken || state?.trim() || 'Ohio';
const stateToken = state?.trim() || 'OH';
const fallbackQuery = `${fallbackQueryBase}, ${stateToken}`;
const fallbackZoom = hasCoordinates ? DEFAULT_LOCATION_MAP_ZOOM + 2 : DEFAULT_LOCATION_MAP_ZOOM;
const mapZoom = Number.isFinite(zoom) ? zoom : fallbackZoom;
const mapQueryBase = nameToken || cityToken || fallbackQueryBase;
const mapQuery =
  mapQueryBase && stateToken && !mapQueryBase.includes(stateToken)
    ? `${mapQueryBase}, ${stateToken}`
    : mapQueryBase;
const mapSrc = mapQuery
  ? `https://www.google.com/maps?q=${encodeURIComponent(mapQuery)}&z=${mapZoom}&output=embed`
  : `https://www.google.com/maps?q=${encodeURIComponent('Ohio')}&z=${mapZoom}&output=embed`;
const mapTitle = `${name} Service Area Map`;
const isDev = import.meta.env.DEV;
---

<section class="py-12 bg-white">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="max-w-3xl mx-auto text-center mb-6">
      <p class="text-xs font-semibold uppercase tracking-[0.25em] text-ink/60">Service Area Coverage</p>
      <p class="mt-2 text-sm text-ink/70">
        This map highlights our primary service area for {city}, {stateToken}.
      </p>
      {isDev && (
        <p class="mt-3 text-xs text-ink/60">
          Map debug: {name} {hasCoordinates ? `${lat},${lng}` : 'no coords'} zoom {mapZoom}
        </p>
      )}
    </div>

    <div class="mx-auto w-full max-w-[520px] overflow-hidden rounded-[12px] border border-ink/10 shadow-sm">
      <iframe
        title={mapTitle}
        src={mapSrc}
        loading="lazy"
        class="h-[260px] w-full"
        referrerpolicy="no-referrer-when-downgrade"
      ></iframe>
    </div>
  </div>
</section>
